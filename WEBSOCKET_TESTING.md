# WebSocket测试工具使用说明

## 概述
本项目提供了多个WebSocket测试页面，用于测试小智物联网服务器的WebSocket连接和消息通信功能。

## 测试页面介绍

### 1. 完整测试工具 (`/ws-test.html`)
- **特点**: 功能最全面的测试工具
- **功能**:
  - 完整的连接管理界面
  - 预定义消息模板
  - 自定义消息发送
  - 详细的连接状态显示
  - 实时消息日志
  - 快速操作按钮
- **适用场景**: 详细的功能测试和调试

### 2. 简易测试 (`/simple-ws-test.html`)
- **特点**: 界面简洁，操作简单
- **功能**:
  - 基本连接功能
  - 常用消息快捷发送
  - 自定义消息支持
  - 简洁的日志显示
- **适用场景**: 快速测试和日常使用

### 3. 调试测试 (`/debug-ws.html`)
- **特点**: 专注于调试和问题排查
- **功能**:
  - 纯文本日志显示
  - 详细的错误信息
  - 简化的操作界面
  - 实时连接状态监控
- **适用场景**: 问题调试和技术排查

## 使用方法

### 基本操作步骤
1. 启动小智服务器: `npm start` 或 `PORT=8000 npm start`
2. 打开浏览器访问: `http://localhost:8000`
3. 点击相应的测试工具链接
4. 在测试页面中输入服务器地址(默认为ws://localhost:8000)
5. 点击"连接服务器"按钮
6. 使用各种按钮发送测试消息

### 支持的消息类型

#### Hello握手消息
```json
{
  "type": "hello",
  "version": 1,
  "transport": "websocket",
  "audio_params": {
    "format": "opus",
    "sample_rate": 16000,
    "channels": 1,
    "frame_duration": 60
  }
}
```

#### IoT设备描述符
```json
{
  "type": "iot",
  "descriptors": {
    "device_id": "your_device_id",
    "name": "设备名称",
    "capabilities": {
      "sensors": ["temperature", "humidity"],
      "actuators": ["led"]
    }
  }
}
```

#### IoT设备状态
```json
{
  "type": "iot",
  "states": {
    "temperature": "25.6",
    "humidity": "60.2",
    "led": "on"
  }
}
```

#### 聊天消息
```json
{
  "type": "chat",
  "text": "聊天内容",
  "state": "complete"
}
```

## 服务器配置

确保服务器配置正确：
- 默认端口: 8000
- WebSocket路径: `/`
- 支持的协议版本: 1

## 常见问题

### 连接失败
- 检查服务器是否正常运行
- 确认端口号是否正确
- 检查防火墙设置

### 消息发送失败
- 确保已成功建立连接
- 检查消息格式是否正确
- 查看服务器日志获取详细错误信息

### 协议验证错误
- 确认消息中的version字段为1
- 确认transport字段为"websocket"
- 检查必需字段是否存在

## 开发建议

1. **测试顺序**: 建议先使用调试测试页面确认基本连接，再使用完整测试工具进行详细测试
2. **日志查看**: 注意查看浏览器控制台和服务器日志
3. **逐步测试**: 从简单的Hello消息开始，逐步测试复杂功能
4. **环境隔离**: 在开发环境中充分测试后再部署到生产环境

## 技术细节

- 使用标准WebSocket API
- 支持JSON和二进制消息
- 自动重连机制
- 实时状态监控
- 详细的错误处理

如需更多帮助，请查看服务器日志或联系技术支持。